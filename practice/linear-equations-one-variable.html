<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Linear Equations in One Variable — Quiz | Dream School Academy</title>

  <!-- this file lives in /practice/, so use ../ -->
  <link rel="stylesheet" href="../style.css" />
  <style>
    :root{
      --bg:#0f1420; --card:#1b2231; --ink:#e8eefc; --muted:#a9b5cc; --brand:#00d8ff;
      --border:rgba(255,255,255,.08); --ok:#29c46d; --bad:#ff6b6b;
    }
    body{ background:var(--bg); color:var(--ink); }
    main{ max-width:960px; margin:0 auto; padding:24px; }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:22px; }
    .bar{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:16px; }
    h1{ margin:0; font-size:1.5rem }
    .muted{ color:var(--muted) }
    .q-stem{ font-size:1.06rem; line-height:1.6; margin-bottom:14px; }
    .choices{ display:grid; gap:10px; }
    .choice{ display:flex; gap:10px; align-items:flex-start; padding:12px 14px; border:1px solid var(--border); border-radius:10px; cursor:pointer; background:#0f1624; }
    .choice.correct{ outline:2px solid var(--ok); }
    .choice.incorrect{ outline:2px solid var(--bad); }
    .nav{ display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; }
    .btn{ background:var(--brand); color:#051018; border:0; border-radius:999px; padding:10px 16px; font-weight:800; cursor:pointer; }
    .btn.secondary{ background:transparent; color:var(--ink); border:1px solid var(--border) }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }
    .hr{ height:1px; background:var(--border); margin:16px 0; }
    .results h2{ margin:.2rem 0 1rem }
    .badge{ display:inline-block; padding:3px 8px; border-radius:999px; font-weight:800; font-size:.85rem }
    .badge.ok{ background:rgba(41,196,109,.15); color:var(--ok); }
    .badge.bad{ background:rgba(255,107,107,.15); color:var(--bad); }
    .stat{ color:#cfe6ff; font-weight:800 }
    .small{ font-size:.93rem }
    .save-note{ color:#9be7ff; margin-top:8px; display:none }
    .last-attempt{ background:#141b29; border:1px dashed var(--border); border-radius:12px; padding:10px 12px; margin-bottom:12px; color:#cfe6ff; }
  </style>

  <!-- MathJax (renders TeX like \( \frac{4}{25}m \)) -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'],['$','$']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <header>
    <div class="header-container">
      <a href="/" class="logo-button">Dream School Academy</a>
      <nav>
        <a href="/study">Study</a>
        <a href="/practice">Practice</a>
        <a href="/contactus">Contact Us</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- Quiz -->
    <div class="card" id="quiz">
      <div class="bar">
        <h1 id="title">Linear Equations in One Variable — Quiz</h1>
        <div class="muted"><span id="idx">1</span>/<span id="total">0</span></div>
      </div>

      <div id="lastAttempt" class="last-attempt" style="display:none"></div>

      <div id="stem" class="q-stem"></div>
      <div id="choices" class="choices"></div>

      <div class="nav">
        <button id="prev" class="btn secondary">Back</button>
        <button id="next" class="btn secondary">Next</button>
        <button id="submit" class="btn">Grade</button>
      </div>
      <p class="muted small">You can change answers before grading. Math is formatted automatically.</p>
      <p id="saved" class="save-note">Saved ✔ Your latest attempt was stored on this device.</p>
    </div>

    <!-- Results -->
    <div class="card" id="results" style="display:none">
      <h2>Results</h2>
      <p class="stat" id="scoreLine"></p>
      <div class="hr"></div>
      <div id="review"></div>
      <div class="nav">
        <button id="retry" class="btn">Retry</button>
        <a href="/practice" class="btn secondary">Back to Practice</a>
      </div>
    </div>
  </main>

  <script>
    // ---------- DATA ----------
    const TOPIC = "linear-equations-one-variable";
    const QUESTIONS = [
      {
        id:"26fac581",
        stem:"If \\(2(x-5)+3(x-5)=10\\), what is the value of \\(x-5\\)?",
        choices:["2","5","7","12"],
        answer:0
      },
      {
        id:"48bad848",
        stem:"Megan’s regular wage at her job is \\(p\\) dollars per hour for the first 8 hours of work in a day plus 1.5 times her regular hourly wage for work in excess of 8 hours that day. On a given day, Megan worked for 10 hours, and her total earnings for that day were \\(\\$137.50\\). What is Megan’s regular hourly wage?",
        choices:["$11.75","$12.50","$13.25","$13.75"],
        answer:1
      },
      {
        id:"f0581e16",
        stem:"Gas is \\(\\$4\\)/gal and the car averages 25 mpg. Alan wants to reduce weekly gas spending by \\(\\$5\\). Let \\(m\\) be miles fewer per week. Which equation is correct?",
        choices:["\\(\\tfrac{25}{4}m=95\\)","\\(\\tfrac{25}{4}m=5\\)","\\(\\tfrac{4}{25}m=95\\)","\\(\\tfrac{4}{25}m=5\\)"],
        answer:3
      },
      {
        id:"6e706172",
        stem:"A product costs \\(\\$65\\) to make and sells for \\(\\$100\\). The salesperson earns a commission equal to 20% of the sales price. Profit per unit equals price minus the combined cost of making the product and the commission. Which equation gives the number of units, \\(u\\), the company sold to make a profit of \\(\\$6{,}840\\)?",
        choices:[
          "\\((100(1-0.2)-65)u=6840\\)",
          "\\((100-65)(1-0.2)u=6840\\)",
          "\\(0.8(100)-65u=6840\\)",
          "\\((0.2(100)+65)u=6840\\)"
        ],
        answer:0
      },
      {
        id:"509cb1a6",
        stem:"\\(4x+12=\\dfrac{a(x+3)}{2}\\). If the equation has infinitely many solutions, what is the value of \\(a\\)?",
        choices:["0","3","8","12"],
        answer:2
      }
    ];

    // ---------- STATE & STORAGE ----------
    const STORAGE_KEY = `dsa:quiz:${TOPIC}`;
    const total = QUESTIONS.length;
    let idx = 0;
    let answers = new Array(total).fill(null); // stores choice index

    // restore last attempt (if any)
    try {
      const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
      if (Array.isArray(saved.answers) && saved.answers.length === total) {
        answers = saved.answers;
        renderLastAttempt(saved);
      }
    } catch {}

    // ---------- DOM ----------
    const titleEl = document.getElementById("title");
    const idxEl = document.getElementById("idx");
    const totalEl = document.getElementById("total");
    const stemEl = document.getElementById("stem");
    const choicesEl = document.getElementById("choices");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const submitBtn = document.getElementById("submit");
    const savedNote = document.getElementById("saved");

    const resultsCard = document.getElementById("results");
    const quizCard = document.getElementById("quiz");
    const scoreLine = document.getElementById("scoreLine");
    const reviewEl = document.getElementById("review");
    const retryBtn = document.getElementById("retry");

    totalEl.textContent = total.toString();
    render();

    prevBtn.addEventListener("click", ()=> { if (idx>0) { idx--; render(); } });
    nextBtn.addEventListener("click", ()=> { if (idx<total-1) { idx++; render(); } });
    submitBtn.addEventListener("click", gradeNow);
    retryBtn.addEventListener("click", ()=>{
      answers.fill(null);
      idx = 0;
      resultsCard.style.display = "none";
      quizCard.style.display = "block";
      savedNote.style.display = "none";
      render();
      window.scrollTo({top:0, behavior:'smooth'});
    });

    function render() {
      const q = QUESTIONS[idx];
      idxEl.textContent = (idx+1).toString();

      stemEl.innerHTML = q.stem;
      choicesEl.innerHTML = "";
      q.choices.forEach((c,i)=>{
        const id = `q${idx}_c${i}`;
        const lab = document.createElement("label");
        lab.className = "choice";
        lab.setAttribute("for", id);

        const inp = document.createElement("input");
        inp.type = "radio";
        inp.name = `q${idx}`;
        inp.id = id;
        inp.value = i;
        if (answers[idx] === i) inp.checked = true;

        inp.addEventListener("change", ()=>{
          answers[idx] = i;
        });

        const txt = document.createElement("div");
        txt.innerHTML = c;

        lab.appendChild(inp);
        lab.appendChild(txt);
        choicesEl.appendChild(lab);
      });

      prevBtn.disabled = (idx===0);
      nextBtn.disabled = (idx===total-1);

      // typeset math after DOM update
      if (window.MathJax?.typesetPromise) MathJax.typesetPromise([stemEl, choicesEl]);
    }

    function gradeNow() {
      let correct = 0;
      const items = QUESTIONS.map((q, i) => {
        const ok = answers[i] === q.answer;
        if (ok) correct++;
        return { ...q, userIndex: answers[i], ok };
      });

      // Save attempt
      const payload = {
        answers,
        correct,
        total,
        when: new Date().toISOString()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      savedNote.style.display = "block";

      // Build results UI
      const pct = Math.round(100*correct/total);
      scoreLine.textContent = `Score: ${correct} / ${total} (${pct}%)`;
      reviewEl.innerHTML = "";
      items.forEach((it, n)=>{
        const wrap = document.createElement("div");
        wrap.className = "q-review";
        wrap.style.marginBottom = "14px";
        wrap.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
            <div><strong>Q${n+1}.</strong> <span class="muted">ID: ${it.id}</span></div>
            <span class="badge ${it.ok ? 'ok':'bad'}">${it.ok ? 'Correct':'Incorrect'}</span>
          </div>
          <div class="q-stem" style="margin-top:6px">${it.stem}</div>
        `;

        // choices review
        const list = document.createElement("div");
        list.className = "choices";
        it.choices.forEach((txt, i)=>{
          const row = document.createElement("div");
          row.className = "choice" + (i===it.answer ? " correct" : (i===it.userIndex && i!==it.answer ? " incorrect" : ""));
          row.innerHTML = `<div>${txt}</div>`;
          list.appendChild(row);
        });

        wrap.appendChild(list);
        reviewEl.appendChild(wrap);
      });

      quizCard.style.display = "none";
      resultsCard.style.display = "block";

      // typeset math in results
      if (window.MathJax?.typesetPromise) MathJax.typesetPromise([resultsCard]);
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function renderLastAttempt(saved){
      const box = document.getElementById("lastAttempt");
      const pct = Math.round(100*saved.correct/saved.total);
      const dt = new Date(saved.when);
      box.textContent = `Last attempt: ${saved.correct}/${saved.total} (${pct}%) on ${dt.toLocaleString()}`;
      box.style.display = "block";
    }
  </script>
</body>
</html>
